<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The method of harmonic balance · HarmonicBalance.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="../../assets/logo.png" alt="HarmonicBalance.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>HarmonicBalance.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Background</span><ul><li class="is-active"><a class="tocitem" href>The method of harmonic balance</a><ul class="internal"><li><a class="tocitem" href="#prelude"><span>Frequency conversion in oscillating nonlinear systems</span></a></li><li><a class="tocitem" href="#Harmonic-ansatz-and-harmonic-equations"><span>Harmonic ansatz &amp; harmonic equations</span></a></li><li><a class="tocitem" href="#Duffing_harmeq"><span>Example: the Duffing oscillator</span></a></li></ul></li><li><a class="tocitem" href="../stability_response/">Stability and linear response</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/simple_Duffing/">Introduction: the Duffing oscillator</a></li><li><a class="tocitem" href="../../examples/linear_response/">Introduction: linear response</a></li><li><a class="tocitem" href="../../examples/time_dependent/">Introduction: time-dependent simulations</a></li><li><a class="tocitem" href="../../examples/parametron/">Parametrically driven Duffing resonator: 1D and 2D plots</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/entering_eom/">Entering equations of motion</a></li><li><a class="tocitem" href="../../manual/extracting_harmonics/">Extracting harmonic equations</a></li><li><a class="tocitem" href="../../manual/solving_harmonics/">Solving harmonic equations</a></li><li><a class="tocitem" href="../../manual/plotting/">Analysis and plotting</a></li><li><a class="tocitem" href="../../manual/time_dependent/">Time evolution</a></li><li><a class="tocitem" href="../../manual/linear_response/">Linear response (WIP)</a></li><li><a class="tocitem" href="../../manual/saving/">Saving and loading</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Background</a></li><li class="is-active"><a href>The method of harmonic balance</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The method of harmonic balance</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/master/docs/src/background/harmonic_balance.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="intro_hb"><a class="docs-heading-anchor" href="#intro_hb">The method of harmonic balance</a><a id="intro_hb-1"></a><a class="docs-heading-anchor-permalink" href="#intro_hb" title="Permalink"></a></h1><h2 id="prelude"><a class="docs-heading-anchor" href="#prelude">Frequency conversion in oscillating nonlinear systems</a><a id="prelude-1"></a><a class="docs-heading-anchor-permalink" href="#prelude" title="Permalink"></a></h2><p>HarmonicBalance.jl focuses on harmonically-driven nonlinear systems, i.e., dynamical systems governed by equations of motion where all explicitly time-dependent terms are harmonic. Let us take a general nonlinear system of <span>$N$</span> second-order ODEs with real variables <span>$x_i(t)$</span>, <span>$i = 1,2,\cdots,N$</span> and time <span>$t$</span> as the independent variable,</p><p class="math-container">\[\begin{equation} \label{eq:ode}
  \ddot{\mathbf{x}}(t)+ \mathbf{F}(\mathbf{x}(t), t)=0\:.
\end{equation}\]</p><p>The vector <span>$\mathbf{x}(t) = (x_1(t), ..., x_N(t))^{\text T}$</span> fully describes the state of the system.  Physically, <span>$\mathbf{x}(t)$</span> encompasses the amplitudes of either point-like or collective oscillators (e.g., mechanical resonators, voltage oscillations in RLC circuits, an oscillating electrical dipole moment, or standing modes of an optical cavity). </p><p>As the simplest example, let us first solve the harmonic oscillator in frequency space. The equation of motion is</p><p class="math-container">\[\begin{equation}
\ddot{x}(t) + \gamma \dot{x}(t) + \omega_0^2 x(t) = F \cos(\omega_d t)
\end{equation}\]</p><p>where <span>$\gamma$</span> is the damping coefficient and <span>$\omega_0$</span> the natural frequency. Fourier-transforming both sides of this equation gives</p><p class="math-container">\[\begin{equation}
(\omega_0^2 - \omega^2 + i \omega \gamma) \tilde{x}(\omega) = \frac{F}{2} \left[ \delta(\omega + \omega_d) + \delta(\omega - \omega_d) \right] \,.
\end{equation}\]</p><p>Evidently, <span>$\tilde{x}(\omega)$</span> is only nonvanishing for <span>$\omega = \pm \omega_d$</span>. The system thus responds at the driving frequency only - the behaviour can be captured by a single harmonic. This illustrates the general point that <em>linear systems are exactly solvable</em> by transforming to Fourier space, where the equations are diagonal.</p><p>The situation becomes more complex if nonlinear terms are present, as these cause <em>frequency conversion</em>. Suppose we add a quadratic nonlinearity <span>$\beta x^2(t)$</span> to the equations of motion; an attempt to Fourier-transform gives</p><p class="math-container">\[\begin{equation} \label{eq:duffingFT}
    \text{FT}[x^2](\omega) =  \int x^2(t) e^{-i\omega t} \: dt = \int_{-\infty}^{+\infty} \tilde{x}(\omega&#39;)\tilde{x}(\omega&#39;&#39;) \delta(\omega&#39;&#39;+\omega&#39;-\omega) \: d\omega&#39; \: d\omega&#39;&#39; \,,
\end{equation}\]</p><p>which couples all harmonics <span>$\omega, \omega&#39;, \omega&#39;&#39;$</span> such that <span>$\omega + \omega&#39; + \omega&#39;&#39; = 0$</span>. To lowest order, this means the induced motion at the drive frequency generates a higher harmonic, <span>$\omega_d \rightarrow 2\omega_d$</span>. To higher orders however, the frequency conversion propagates through the spectrum, <em>coupling an infinite number of harmonics</em>. The system is not solvable in Fourier space anymore!</p><h2 id="Harmonic-ansatz-and-harmonic-equations"><a class="docs-heading-anchor" href="#Harmonic-ansatz-and-harmonic-equations">Harmonic ansatz &amp; harmonic equations</a><a id="Harmonic-ansatz-and-harmonic-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Harmonic-ansatz-and-harmonic-equations" title="Permalink"></a></h2><p>Even though we need an infinity of Fourier components to describe our system exactly, some components are more important than others. The strategy of harmonic balance is to describe the motion of any variable <span>$x_i(t)$</span> in a truncated Fourier space</p><p class="math-container">\[\begin{equation}
x_i(t) = \sum_{j=1}^{M_i} u_{i,j}  (T)  \cos(\omega_{i,j} t)+ v_{i,j} (T) \sin(\omega_{i,j} t) \,.
\end{equation}\]</p><p>Within this space, the system is described by a finite-dimensional vector</p><p class="math-container">\[\begin{equation} \label{eq:harmansatz}
\mathbf{u}(T) = (u_{1,1}(T), v_{1,1}(T), \ldots u_{N, M_N}(T), v_{N, M_N}(T))
\end{equation}\]</p><p>Under the assumption that <span>$\mathbf{u}(T)$</span> evolves at much slower timescales than the oscillatory terms <span>$\omega_{i,j} t$</span>, we may neglect all of its higher order time derivatives. Notice that once ansatz \eqref{eq:harmansatz} is used in Eq. \eqref{eq:ode}, all terms become oscillatory - each prefactor of <span>$\cos(\omega_{i,j} t)$</span> and <span>$\sin(\omega_{i,j} t)$</span> thus generates a separate equation. Collecting these, we obtain a 1st order nonlinear ODEs,</p><p class="math-container">\[\begin{equation} \label{eq:harmeq}
\frac{d\mathbf{u}(T)}{dT}  = \bar{\mathbf{F}} (\mathbf{u})\,,
\end{equation}\]</p><p>which we call the <em>harmonic equations</em>. The main purpose of HarmonicBalance.jl is to obtain and solve them. We are primarily interested in <em>steady states</em> <span>$\mathbf{u}_0$</span> defined by <span>$\bar{\mathbf{F}}(\mathbf{u}_0) = 0$</span>.</p><p>The process of obtaining the harmonic equations is best shown on an example.</p><h2 id="Duffing_harmeq"><a class="docs-heading-anchor" href="#Duffing_harmeq">Example: the Duffing oscillator</a><a id="Duffing_harmeq-1"></a><a class="docs-heading-anchor-permalink" href="#Duffing_harmeq" title="Permalink"></a></h2><p>Here, we derive the harmonic equations for a single Duffing resonator, governed by the equation</p><p class="math-container">\[\begin{equation} \label{eq:duffing}
    \ddot{x}(t) + \omega_0^2 x(t) + \alpha x^3(t) = F \cos(\omega_d t + \theta)\,.
\end{equation}\]</p><p>As explained in <a href="#prelude">above</a>, for a periodic driving at frequency <span>$\omega_d$</span> and a weak nonlinearity <span>$\alpha$</span>, we expect the response at frequency <span>$\omega_d$</span> to dominate, followed by a response at <span>$3\omega_d$</span> due to frequency conversion.</p><h3 id="Single-frequency-ansatz"><a class="docs-heading-anchor" href="#Single-frequency-ansatz">Single-frequency ansatz</a><a id="Single-frequency-ansatz-1"></a><a class="docs-heading-anchor-permalink" href="#Single-frequency-ansatz" title="Permalink"></a></h3><p>We first attempt to describe the steady states of Eq. \eqref{eq:duffing} using only one harmonic, <span>$\omega_d$</span>. The starting point is the harmonic ansatz for <span>$x$</span></p><p class="math-container">\[\begin{equation}
	x(t) = u(T) \cos(\omega_d t) + v(T) \sin(\omega_d t)\:,
\end{equation}\]</p><p>with the harmonic variables <span>$u$</span> and <span>$v$</span>. The <em>slow time</em> <span>$T$</span> is, for now, equivalent to <span>$t$</span>. Substituting this ansatz into Eq. \eqref{eq:duffing} results in</p><p class="math-container">\[\begin{align} \label{eq:ansatz1}
	\left[\ddot{u} + 2 \omega_d \dot{v} + u \left(\omega_0^2 - \omega_d^2 \right) +  \frac{3 \alpha \left(u^3 + uv^2\right)}{4} + F \cos{\theta}\right] &amp;\cos(\omega_d t)&amp; \\
	+ \left[\ddot{v} - 2 \omega_d \dot{u} + v \left(\omega_0^2 - \omega_d^2 \right)  +\frac{3 \alpha \left(v^3 + u^2 v\right)}{4} - F \sin{\theta}\right] &amp;\sin(\omega_d t)&amp; \nonumber \\
	+ \frac{\alpha \left(u^3 - 3 u v^2\right)}{4} \cos(3 \omega_d t) +  \frac{\alpha \left(3u^2 v - v^3\right)}{4} \sin(3 \omega_d t) &amp;= 0. \nonumber
\end{align}\]</p><p>We see that the <span>$x^3$</span> term has generated terms that oscillate at <span>$3\omega_d$</span>, describing the process of frequency upconversion. We now Fourier-transform both sides of Eq. \eqref{eq:ansatz1} with respect to <span>$\omega_d$</span> to obtain the harmonic equations. This process is equivalent to extracting the respective coefficients of <span>$\cos(\omega_d t)$</span> and <span>$\sin(\omega_d t)$</span>. Here the distinction between <span>$t$</span> and <span>$T$</span> becomes important: since the evolution of <span>$u(T)$</span> and <span>$v(T)$</span> is assumed to be slow, they are treated as constant for the purpose of the Fourier transformation. Since we are interested in steady states, we drop the higher-order derivatives and rearrange the resulting equation to</p><p class="math-container">\[\begin{equation}
	\frac{d}{dT} \begin{pmatrix} u \\ v  \end{pmatrix} = \frac{1}{8 \omega_d} \begin{pmatrix} 4 v \left(\omega_0^2-\omega_d^2 \right) + 3 \alpha \left(v^3 + u^2 v  \right) - 4 F \sin{\theta}  \\ 4 u \left(\omega_d^2-\omega_0^2 \right)  - 3 \alpha \left(u^3 + u v^2 \right) - 4 F \cos{\theta}  \end{pmatrix} \,.
\end{equation}\]</p><p>Steady states can now be found by setting the l.h.s. to zero, i.e., assuming <span>$u(T)$</span> and <span>$v(T)$</span> constant and neglecting any transient behaviour. This results in a set of 2 nonlinear polynomial equations of order 3, for which the maximum number of solutions set by <a href="https://en.wikipedia.org/wiki/B%C3%A9zout%27s_theorem">Bézout&#39;s theorem</a> is <span>$3^2=9$</span>. Depending on the parameters, the number of real solutions is known to be between 1 and 3.</p><h3 id="Sidenote:-perturbative-approach"><a class="docs-heading-anchor" href="#Sidenote:-perturbative-approach">Sidenote: perturbative approach</a><a id="Sidenote:-perturbative-approach-1"></a><a class="docs-heading-anchor-permalink" href="#Sidenote:-perturbative-approach" title="Permalink"></a></h3><p>The steady states describe a response that may be recast as <span>$x_0(t) = X_0 \cos(\omega_d t + \phi)$</span>, where <span>$X_0=\sqrt{u^2+v^2}$</span> and <span>$\phi=-\text{atan}(v/u)$</span>. Frequency conversion from <span>$\omega_d$</span> to <span>$3 \omega_d$</span> can be found by setting <span>$x(t) \equiv x_0(t) + \delta x(t)$</span> with <span>$|\delta x(t)|\ll|x_0(t)|$</span> and expanding Eq. \eqref{eq:duffing} to first-order in <span>$\delta x(t)$</span>. The resulting equation</p><p class="math-container">\[\begin{equation}
    \delta \ddot{x}(t) + \left[\omega_0^2 + \frac{3 \alpha X_0^2}{4} \right]\delta x(t) = - \frac{\alpha X_0^3}{4} \cos(3 \omega_d t + 3 \phi)\,,
\end{equation}\]</p><p>describes a simple harmonic oscillator, which is exactly soluble. Correspondingly, a response of <span>$\delta x(t)$</span> at frequency <span>$3 \omega_d$</span> is observed. Since this response is obtained &#39;on top of&#39; each steady state of Eq. \eqref{eq:duffing}, no previously-unknown solutions are generated in the process.</p><h3 id="Two-frequency-ansatz"><a class="docs-heading-anchor" href="#Two-frequency-ansatz">Two-frequency ansatz</a><a id="Two-frequency-ansatz-1"></a><a class="docs-heading-anchor-permalink" href="#Two-frequency-ansatz" title="Permalink"></a></h3><p>An approach in the spirit of harmonic balance is to use both harmonics <span>$\omega_d$</span> and <span>$3 \omega_d$</span> on the same footing, i.e., to insert the ansatz</p><p class="math-container">\[\begin{equation}
	x(t) = u_1(T) \cos(\omega_d t) + v_1(T) \sin(\omega_d t) + u_2(T) \cos(3 \omega_d t) + v_2(T) \sin(3\omega_d t)\:,
\end{equation}\]</p><p>with <span>$u_1, u_2, v_1, v_2$</span> being the harmonic variables. As before we substitute the ansatz into Eq. \eqref{eq:duffing}, drop second derivatives with respect to <span>$T$</span> and Fourier-transform both sides. Now, the respective coefficients correspond to <span>$\cos(\omega_d t)$</span>, <span>$\sin(\omega_d t)$</span>, <span>$\cos(3 \omega_d t)$</span> and <span>$\sin(3\omega_d t)$</span>. Rearranging, we obtain</p><p class="math-container">\[	\begin{align}
	\begin{split}
	\frac{du_1}{dT} &amp;=  \frac{1}{2\omega_d} \left[ \left({\omega_0}^{2} - \omega_d^2 \right) v_1 + \frac{3\alpha}{4} \left( v_1^3 + u_1^2 v_1 + u_1^2 v_2 - v_1^2 v_2 + 2 u_2^2 v_1 + 2 v_2^2 v_1 - 2 u_1 u_2 v_1\right)  + F \sin{\theta} \right],
	\\
	\frac{dv_1}{dT} &amp;= \frac{1}{2\omega_d} \left[ \left({\omega_d}^{2} - \omega_0^2 \right) {u_1} - \frac{3 \alpha}{4} \left( u_1^3 + u_1^2 u_2 + v_1^2 u_1 - v_1^2 u_2+ 2 u_2^2 u_1 + 2 v_2^2 u_1  + 2 u_1 v_1 v_2\right) - F \cos{\theta} \right],
	\\
	\frac{d u_2}{dT} &amp;= \frac{1}{6 \omega_d} \left[ \left(\omega_0^{2} - 9\omega_d^2 \right) {v_2} + \frac{\alpha}{4} \left( - v_1^3 + 3 v_2^3 + 3 u_1^2 v_1 + 6 u_1^2 v_2 + 3 u_2^2 v_2 + 6 v_1^2 v_2\right) \right],
	\\
	\frac{dv_2}{dT} &amp;= \frac{1}{6 \omega_d} \left[ \left(9\omega_d^2 - \omega_0^2\right) {u_2} - \frac{\alpha}{4} \left( u_1^3 + 3 u_2^3 + 6 u_1^2 u_2 - 3 v_1^2 u_1 + 3 v_2^2 u_2 + 6 v_1^2 u_2\right) \right] \:.
	\end{split}
	\end{align}\]</p><p>In contrast to the single-frequency ansatz [Eqs. \eqref{eq:ansatz1}],  we now have 4 equations of order 3, allowing up to <span>$3^4=81$</span> solutions (the number of unique real ones is again generally far smaller). The larger number of solutions is explained by higher harmonics which cannot be captured perturbatively by the single-frequency ansatz. In particular, those where the <span>$3 \omega_d$</span> component is significant. Such solutions appear, e.g., for <span>$\omega_d \approx \omega_0 / 3$</span> where the generated <span>$3 \omega_d$</span> harmonic is close to the natural resonant frequency. See the <a href="../../examples/simple_Duffing/#Duffing">examples</a> for numerical results.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="../stability_response/">Stability and linear response »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 3 October 2022 12:19">Monday 3 October 2022</span>. Using Julia version 1.8.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
