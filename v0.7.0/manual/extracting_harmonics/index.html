<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Extracting harmonic equations · HarmonicBalance.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../background/harmonic_balance/"><img src="../../assets/logo.png" alt="HarmonicBalance.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../background/harmonic_balance/">HarmonicBalance.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Background</span><ul><li><a class="tocitem" href="../../background/harmonic_balance/">The method of harmonic balance</a></li><li><a class="tocitem" href="../../background/stability_response/">Stability and linear response</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/simple_Duffing/">Introduction: the Duffing oscillator</a></li><li><a class="tocitem" href="../../examples/linear_response/">Introduction: linear response</a></li><li><a class="tocitem" href="../../examples/time_dependent/">Introduction: time-dependent simulations</a></li><li><a class="tocitem" href="../../examples/parametron/">Parametrically driven Duffing resonator: 1D and 2D plots</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../entering_eom/">Entering equations of motion</a></li><li class="is-active"><a class="tocitem" href>Extracting harmonic equations</a><ul class="internal"><li><a class="tocitem" href="#Harmonic-Balance-method"><span>Harmonic Balance method</span></a></li><li><a class="tocitem" href="#Krylov-Bogoliubov-averaging-method"><span>Krylov-Bogoliubov averaging method</span></a></li><li><a class="tocitem" href="#HarmonicVariable-and-HarmonicEquation-types"><span>HarmonicVariable and HarmonicEquation types</span></a></li></ul></li><li><a class="tocitem" href="../solving_harmonics/">Solving harmonic equations</a></li><li><a class="tocitem" href="../plotting/">Analysis and plotting</a></li><li><a class="tocitem" href="../time_dependent/">Time evolution</a></li><li><a class="tocitem" href="../linear_response/">Linear response (WIP)</a></li><li><a class="tocitem" href="../saving/">Saving and loading</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Extracting harmonic equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Extracting harmonic equations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/master/docs/src/manual/extracting_harmonics.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Extracting-harmonic-equations"><a class="docs-heading-anchor" href="#Extracting-harmonic-equations">Extracting harmonic equations</a><a id="Extracting-harmonic-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-harmonic-equations" title="Permalink"></a></h1><h2 id="Harmonic-Balance-method"><a class="docs-heading-anchor" href="#Harmonic-Balance-method">Harmonic Balance method</a><a id="Harmonic-Balance-method-1"></a><a class="docs-heading-anchor-permalink" href="#Harmonic-Balance-method" title="Permalink"></a></h2><p>Once a <code>DifferentialEquation</code> is defined and its harmonics specified, one can extract the harmonic equations using <code>get_harmonic_equations</code>, which itself is composed of the subroutines <code>harmonic_ansatz</code>, <code>slow_flow</code>, <code>fourier_transform!</code> and <code>drop_powers</code>. </p><p>The harmonic equations use an additional time variable specified as <code>slow_time</code> in <code>get_harmonic_equations</code>. This is essentially a label distinguishing the time dependence of the harmonic variables (expected to be slow) from that of the oscillating terms (expeted to be fast). When the equations are Fourier-transformed to remove oscillating terms, <code>slow_time</code> is treated as a constant. Such an approach is exact when looking for steady states. </p><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.get_harmonic_equations" href="#HarmonicBalance.get_harmonic_equations"><code>HarmonicBalance.get_harmonic_equations</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_harmonic_equations(diff_eom::DifferentialEquation; fast_time=nothing, slow_time=nothing)</code></pre><p>Apply the harmonic ansatz, followed by the slow-flow, Fourier transform and dropping higher-order derivatives to obtain a set of ODEs (the harmonic equations) governing the harmonics of <code>diff_eom</code>.</p><p>The harmonics evolve in <code>slow_time</code>, the oscillating terms themselves in <code>fast_time</code>. If no input is used, a variable T is defined for <code>slow_time</code> and <code>fast_time</code> is taken as the independent variable of <code>diff_eom</code>.</p><p>By default, all products of order &gt; 1 of <code>slow_time</code>-derivatives are dropped, which means the equations are linear in the time-derivatives.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; @variables t, x(t), ω0, ω, F;

# enter the simple harmonic oscillator
julia&gt; diff_eom = DifferentialEquation( d(x,t,2) + ω0^2 * x ~ F *cos(ω*t), x);

# expand x in the harmonic ω
julia&gt; add_harmonic!(diff_eom, x, ω);

# get equations for the harmonics evolving in the slow time T
julia&gt; harmonic_eom = get_harmonic_equations(diff_eom)

A set of 2 harmonic equations
Variables: u1(T), v1(T)
Parameters: ω0, ω, F

Harmonic ansatz:
x(t) = u1*cos(ωt) + v1*sin(ωt)

Harmonic equations:

(ω0^2)*u1(T) + (2//1)*ω*Differential(T)(v1(T)) - (ω^2)*u1(T) ~ F

(ω0^2)*v1(T) - (ω^2)*v1(T) - (2//1)*ω*Differential(T)(u1(T)) ~ 0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/HarmonicEquation.jl#L219-L260">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.harmonic_ansatz" href="#HarmonicBalance.harmonic_ansatz"><code>HarmonicBalance.harmonic_ansatz</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">harmonic_ansatz(eom::DifferentialEquation, time::Num; coordinates=&quot;Cartesian&quot;)</code></pre><p>Expand each variable of <code>diff_eom</code> using the harmonics assigned to it with <code>time</code> as the time variable. For each harmonic of each variable, instance(s) of <code>HarmonicVariable</code> are automatically created and named.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/HarmonicEquation.jl#L10-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.slow_flow" href="#HarmonicBalance.slow_flow"><code>HarmonicBalance.slow_flow</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">slow_flow(eom::HarmonicEquation; fast_time::Num, slow_time::Num, degree=2)</code></pre><p>Removes all derivatives w.r.t <code>fast_time</code> (and their products) in <code>eom</code> of power <code>degree</code>. In the remaining derivatives, <code>fast_time</code> is replaced by <code>slow_time</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/HarmonicEquation.jl#L68-L73">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.fourier_transform" href="#HarmonicBalance.fourier_transform"><code>HarmonicBalance.fourier_transform</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">fourier_transform(
    eom::HarmonicEquation,
    time::Symbolics.Num
) -&gt; HarmonicEquation
</code></pre><p>Extract the Fourier components of <code>eom</code> corresponding to the harmonics specified in <code>eom.variables</code>. For each non-zero harmonic of each variable, 2 equations are generated (cos and sin Fourier coefficients). For each zero (constant) harmonic, 1 equation is generated <code>time</code> does not appear in the resulting equations anymore.</p><p>Underlying assumption: all time-dependences are harmonic.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/HarmonicEquation.jl#L181">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.drop_powers" href="#HarmonicBalance.drop_powers"><code>HarmonicBalance.drop_powers</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">drop_powers(expr, vars, deg)
</code></pre><p>Remove parts of <code>expr</code> where the combined power of <code>vars</code> is =&gt; <code>deg</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; @variables x,y;
julia&gt;drop_powers((x+y)^2, x, 2)
y^2 + 2*x*y
julia&gt;drop_powers((x+y)^2, [x,y], 2)
0
julia&gt;drop_powers((x+y)^2 + (x+y)^3, [x,y], 3)
x^2 + y^2 + 2*x*y</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/Symbolics_utils.jl#L72">source</a></section></article><h2 id="Krylov-Bogoliubov-averaging-method"><a class="docs-heading-anchor" href="#Krylov-Bogoliubov-averaging-method">Krylov-Bogoliubov averaging method</a><a id="Krylov-Bogoliubov-averaging-method-1"></a><a class="docs-heading-anchor-permalink" href="#Krylov-Bogoliubov-averaging-method" title="Permalink"></a></h2><p>As laid out in the background section, <code>get_harmonic_equations</code> computes the slow-flow equation with the help of the Harmoninc Balance method. However, another well-known would be the Krylov-Bogoliubov averaging method. The advantage of the method is that it can computed higher orders in <span>$1/\omega$</span> which thereby capture the faster dynamics. Nevertheless, the method cannot work with mutliple harmonic in one variable. The Krylov-Bogoliubov can be computed with the function <code>get_krylov_equations</code>.</p><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.KrylovBogoliubov.get_krylov_equations" href="#HarmonicBalance.KrylovBogoliubov.get_krylov_equations"><code>HarmonicBalance.KrylovBogoliubov.get_krylov_equations</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_krylov_equations(
    diff_eom::DifferentialEquation;
    order,
    fast_time,
    slow_time
)
</code></pre><p>Apply the Krylov-Bogoliubov averaging method to a specific <code>order</code> to obtain a set of ODEs (the slow-flow equations) governing the harmonics of <code>diff_eom</code>.</p><p>The harmonics evolve in <code>slow_time</code>, the oscillating terms themselves in <code>fast_time</code>. If no input is used, a variable T is defined for <code>slow_time</code> and <code>fast_time</code> is taken as the independent variable of <code>diff_eom</code>.</p><p>Krylov-Bogoliubov averaging method can be applied up to <code>order = 2</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; @variables t, x(t), ω0, ω, F;

# enter the simple harmonic oscillator
julia&gt; diff_eom = DifferentialEquation( d(x,t,2) + ω0^2 * x ~ F *cos(ω*t), x);

# expand x in the harmonic ω
julia&gt; add_harmonic!(diff_eom, x, ω);

# get equations for the harmonics evolving in the slow time T to first order
julia&gt; harmonic_eom = get_krylov_equations(diff_eom, order = 1)

A set of 2 harmonic equations
Variables: u1(T), v1(T)
Parameters: ω, F, ω0

Harmonic ansatz:
xˍt(t) =
x(t) = u1(T)*cos(ωt) + v1(T)*sin(ωt)

Harmonic equations:

((1//2)*(ω^2)*v1(T) - (1//2)*(ω0^2)*v1(T)) / ω ~ Differential(T)(u1(T))

((1//2)*(ω0^2)*u1(T) - (1//2)*F - (1//2)*(ω^2)*u1(T)) / ω ~ Differential(T)(v1(T))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/modules/KrylovBogoliubov/KrylovEquation.jl#L6">source</a></section></article><h2 id="HarmonicVariable-and-HarmonicEquation-types"><a class="docs-heading-anchor" href="#HarmonicVariable-and-HarmonicEquation-types">HarmonicVariable and HarmonicEquation types</a><a id="HarmonicVariable-and-HarmonicEquation-types-1"></a><a class="docs-heading-anchor-permalink" href="#HarmonicVariable-and-HarmonicEquation-types" title="Permalink"></a></h2><p>The equations governing the harmonics are stored using the two following structs. When going from the original to the harmonic equations, the harmonic ansatz <span>$x_i(t) = \sum_{j=1}^M u_{i,j}  (T)  \cos(\omega_{i,j} t)+ v_{i,j}(T) \sin(\omega_{i,j} t)$</span> is used. Internally, each pair <span>$(u_{i,j}, v_{i,j})$</span> is stored as a <code>HarmonicVariable</code>. This includes the identification of <span>$\omega_{i,j}$</span> and <span>$x_i(t)$</span>, which is needed to later reconstruct <span>$x_i(t)$</span>.</p><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.HarmonicVariable" href="#HarmonicBalance.HarmonicVariable"><code>HarmonicBalance.HarmonicVariable</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct HarmonicVariable</code></pre><p>Holds a variable stored under <code>symbol</code> describing the harmonic <code>ω</code> of <code>natural_variable</code>.</p><p><strong>Fields</strong></p><ul><li><p><code>symbol::Symbolics.Num</code>: Symbol of the variable in the HarmonicBalance namespace.</p></li><li><p><code>name::String</code>: Human-readable labels of the variable, used for plotting.</p></li><li><p><code>type::String</code>: Type of the variable (u or v for quadratures, a for a constant, Hopf for Hopf etc.)</p></li><li><p><code>ω::Symbolics.Num</code>: The harmonic being described.</p></li><li><p><code>natural_variable::Symbolics.Num</code>: The natural variable whose harmonic is being described.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/types.jl#L68">source</a></section></article><p>When the full set of equations of motion is expanded using the harmonic ansatz, the result is stored as a <code>HarmonicEquation</code>. For an initial equation of motion consisting of <span>$M$</span> variables, each expanded in <span>$N$</span> harmonics, the resulting <code>HarmonicEquation</code> holds <span>$2NM$</span> equations of <span>$2NM$</span> variables. Each symbol not corresponding to a variable is identified as a parameter. </p><p>A <code>HarmonicEquation</code> can be either parsed into a steady-state <code>Problem</code> or solved using a dynamical ODE solver.</p><article class="docstring"><header><a class="docstring-binding" id="HarmonicBalance.HarmonicEquation" href="#HarmonicBalance.HarmonicEquation"><code>HarmonicBalance.HarmonicEquation</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct HarmonicEquation</code></pre><p>Holds a set of algebraic equations governing the harmonics of a <code>DifferentialEquation</code>.</p><p><strong>Fields</strong></p><ul><li><p><code>equations::Vector{Symbolics.Equation}</code>: A set of equations governing the harmonics.</p></li><li><p><code>variables::Vector{HarmonicVariable}</code>: A set of variables describing the harmonics.</p></li><li><p><code>parameters::Vector{Symbolics.Num}</code>: The parameters of the equation set.</p></li><li><p><code>natural_equation::DifferentialEquation</code>: The natural equation (before the harmonic ansatz was used).</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NonlinearOscillations/HarmonicBalance.jl/blob/8df659642af3c64ec814f926d5690e43140cce41/src/types.jl#L95">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../entering_eom/">« Entering equations of motion</a><a class="docs-footer-nextpage" href="../solving_harmonics/">Solving harmonic equations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 24 October 2023 13:32">Tuesday 24 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
